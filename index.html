<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Umoomi Security System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:"Segoe UI",sans-serif;background:#f2f2f2;padding:20px}
.container{max-width:1400px;margin:auto}

/* HEADER */
header{
  background:#fff;padding:20px;border-radius:10px;
  display:flex;align-items:center;gap:15px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  margin-bottom:20px
}
header i{font-size:2.5rem;color:#2c3e50}

/* LAYOUT */
.layout{display:grid;grid-template-columns:240px 1fr;gap:20px}

/* SIDEBAR */
aside{
  background:#fff;border-radius:10px;padding:15px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  height:calc(100vh - 160px)
}
aside button{
  width:100%;border:none;background:none;
  padding:12px 15px;border-radius:6px;
  text-align:left;color:#2c3e50;
  cursor:pointer;margin-bottom:6px;font-size:1rem
}
aside button i{width:22px;margin-right:10px}
aside button.active,aside button:hover{
  background:#3498db;color:#fff
}

/* MAIN */
main{
  background:#fff;border-radius:10px;padding:20px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  height:calc(100vh - 160px);
  overflow:auto
}

/* STATS */
.stats{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:15px;margin-bottom:20px
}
.stat{
  background:linear-gradient(135deg,#2c3e50,#3498db);
  color:#fff;padding:18px;border-radius:10px;
  text-align:center
}
.stat i{font-size:2rem;margin-bottom:6px}
.stat .number{font-size:1.8rem;font-weight:bold}

/* QUICK ACTIONS */
.quick-actions{
  display:flex;gap:10px;margin-bottom:20px
}
.quick-actions button{
  flex:1;padding:12px;border:none;border-radius:8px;
  cursor:pointer;font-size:.95rem;
  background:#ecf5ff;color:#2c3e50
}
.quick-actions button i{margin-right:6px}

/* CHARTS */
.charts{
  background:#f8f9fa;
  border-radius:10px;
  padding:20px
}
.chart-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
  margin-top:15px
}
</style>
</head>

<body>
<div class="container">

<header>
  <i class="fas fa-shield-alt"></i>
  <div>
    <h2>Umoomi Security System</h2>
    <small>Ahmadiyya Muslim Community Uganda</small>
  </div>
</header>

<div class="layout">

<!-- SIDEBAR -->
<aside>
  <button class="active"><i class="fas fa-chart-line"></i> Dashboard</button>
  <button><i class="fas fa-users"></i> Members</button>
  <button><i class="fas fa-qrcode"></i> Scan ID</button>
  <button><i class="fas fa-map-marker-alt"></i> Regions</button>
  <button><i class="fas fa-history"></i> Activity Logs</button>
  <button><i class="fas fa-user-shield"></i> Admin Panel</button>
  <button><i class="fas fa-cog"></i> Settings</button>
</aside>

<!-- MAIN -->
<main>

<!-- STATS -->
<div class="stats">
  <div class="stat">
    <i class="fas fa-users"></i>
    <div>Total Members</div>
    <div id="totalMembers" class="number">0</div>
  </div>

  <div class="stat">
    <i class="fas fa-user-check"></i>
    <div>Active Members</div>
    <div id="activeMembers" class="number">0</div>
  </div>

  <div class="stat">
    <i class="fas fa-map-marker-alt"></i>
    <div>Total Regions</div>
    <div id="regionsCount" class="number">0</div>
  </div>

  <div class="stat">
    <i class="fas fa-clock"></i>
    <div>Last Scan</div>
    <div id="lastScan" class="number">-</div>
  </div>
</div>

<!-- QUICK ACTIONS -->
<div class="quick-actions">
  <button><i class="fas fa-envelope"></i> Messages</button>
  <button><i class="fas fa-bell"></i> Reminders</button>
  <button><i class="fas fa-calendar"></i> Events</button>
  <button><i class="fas fa-file-alt"></i> Reports</button>
</div>

<!-- ANALYTICS -->
<div class="charts">
  <h3>Analytics & Performance</h3>

  <div class="chart-grid">
    <canvas id="dailyChart"></canvas>
    <canvas id="regionChart"></canvas>
  </div>
</div>

</main>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", async ()=>{

  const supabase = window.supabase.createClient(
    "https://pqrsljahrnjgkadflbmr.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo"
  );

  /* MEMBERS */
  const { data: members, error } =
    await supabase.from("umoomi_members").select("*");

  if(error){
    console.error(error);
    return;
  }

  totalMembers.textContent = members.length;
  activeMembers.textContent =
    members.filter(m=>m.status==="Active").length;
  regionsCount.textContent =
    new Set(members.map(m=>m.region)).size;

  /* SCANS */
  const { data: scans } =
    await supabase.from("scan_logs")
    .select("created_at,region")
    .order("created_at",{ascending:false});

  if(scans && scans.length){
    lastScan.textContent =
      new Date(scans[0].created_at).toLocaleString();
  }

  /* DAILY SCANS CHART */
  const daily = {};
  scans?.forEach(s=>{
    const d = new Date(s.created_at).toLocaleDateString();
    daily[d] = (daily[d]||0)+1;
  });

  new Chart(dailyChart,{
    type:"line",
    data:{
      labels:Object.keys(daily),
      datasets:[{
        label:"Scans",
        data:Object.values(daily),
        borderColor:"#3498db",
        backgroundColor:"rgba(52,152,219,.2)",
        tension:.4,
        fill:true
      }]
    }
  });

  /* REGION CHART */
  const regions={};
  scans?.forEach(s=>{
    if(s.region)
      regions[s.region]=(regions[s.region]||0)+1;
  });

  new Chart(regionChart,{
    type:"bar",
    data:{
      labels:Object.keys(regions),
      datasets:[{
        label:"Scans",
        data:Object.values(regions),
        backgroundColor:"#2c3e50"
      }]
    }
  });

});
</script>

</body>
</html>
