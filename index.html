<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Umoomi Security System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #6a6fdc, #7b5fc9);
}

.header {
  background: #fff;
  padding: 15px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 10px rgba(0,0,0,.1);
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1.3rem;
  font-weight: 600;
}

.container {
  display: flex;
  padding: 20px;
  gap: 20px;
}

.sidebar {
  width: 220px;
  background: #fff;
  border-radius: 10px;
  padding: 15px;
}

.sidebar a {
  display: block;
  padding: 10px;
  color: #333;
  text-decoration: none;
  border-radius: 6px;
  margin-bottom: 5px;
  cursor: pointer;
}

.sidebar a.active,
.sidebar a:hover {
  background: #3498db;
  color: #fff;
}

.main {
  flex: 1;
  background: #fff;
  border-radius: 10px;
  padding: 20px;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.card {
  background: linear-gradient(135deg,#2c3e50,#3498db);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
}

.card p {
  font-size: 2rem;
  margin: 5px 0 0;
}

.hidden { display: none; }

input {
  padding: 8px;
  width: 300px;
  margin-bottom: 10px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  background: #2c3e50;
  color: white;
  padding: 12px;
}

td {
  padding: 10px;
  border-bottom: 1px solid #eee;
}

.badge {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: .8rem;
}

.active { background:#d4edda;color:#155724; }
.inactive { background:#e2e3e5;color:#383d41; }
.suspended { background:#f8d7da;color:#721c24; }

.card-preview {
  width: 300px;
  border: 2px solid #333;
  padding: 15px;
  border-radius: 10px;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="header">
  <div class="logo">
    <i class="fas fa-shield-alt"></i>
    Umoomi Security System
  </div>
  <div>Guest</div>
</div>

<div class="container">

  <div class="sidebar">
    <a class="active" onclick="showPage('dashboard')">Dashboard</a>
    <a onclick="showPage('scanner')">Scan ID Card</a>
    <a onclick="showPage('cards')">Generate Cards</a>
  </div>

  <div class="main">

    <!-- DASHBOARD -->
    <div id="dashboard">
      <div class="cards">
        <div class="card">Total Members<p id="totalMembers">0</p></div>
        <div class="card">Active Members<p id="activeMembers">0</p></div>
        <div class="card">Regions<p id="regions">0</p></div>
      </div>

      <input id="searchInput" placeholder="Search members...">

      <table>
        <thead>
          <tr>
            <th>ID</th><th>Name</th><th>Position</th>
            <th>Department</th><th>Region</th><th>Status</th>
          </tr>
        </thead>
        <tbody id="membersBody"></tbody>
      </table>
    </div>

    <!-- SCANNER -->
    <div id="scanner" class="hidden">
      <h2>Scan ID Card</h2>
      <p>Camera scanning (QR / Barcode) will work on HTTPS.</p>
      <video id="video" width="400" autoplay></video>
    </div>

    <!-- GENERATE CARD -->
    <div id="cards" class="hidden">
      <h2>Generate ID Card</h2>
      <select id="cardMember"></select>
      <button onclick="generateCard()">Generate</button>

      <div id="cardPreview"></div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://pqrsljahrnjgkadflbmr.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo";


const client = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

let members = [];

function showPage(id) {
  document.querySelectorAll(".main > div").forEach(d => d.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

async function loadMembers() {
  const { data } = await client.from("umoomi_members").select("*");
  members = data || [];
  renderTable(members);
  populateStats();
  populateCardSelect();
}

function renderTable(list) {
  const body = document.getElementById("membersBody");
  body.innerHTML = "";
  list.forEach(m => {
    body.innerHTML += `
      <tr>
        <td>${m.member_id}</td>
        <td>${m.full_name}</td>
        <td>${m.position}</td>
        <td>${m.department}</td>
        <td>${m.region || "-"}</td>
        <td><span class="badge ${m.status.toLowerCase()}">${m.status}</span></td>
      </tr>`;
  });
}

function populateStats() {
  document.getElementById("totalMembers").textContent = members.length;
  document.getElementById("activeMembers").textContent =
    members.filter(m => m.status === "Active").length;
  document.getElementById("regions").textContent =
    new Set(members.map(m => m.region).filter(Boolean)).size;
}

document.getElementById("searchInput").addEventListener("input", e => {
  const v = e.target.value.toLowerCase();
  renderTable(members.filter(m =>
    m.full_name.toLowerCase().includes(v) ||
    m.member_id.toLowerCase().includes(v)
  ));
});

function populateCardSelect() {
  const sel = document.getElementById("cardMember");
  sel.innerHTML = members.map(m =>
    `<option value="${m.member_id}">${m.full_name}</option>`
  ).join("");
}

function generateCard() {
  const id = document.getElementById("cardMember").value;
  const m = members.find(x => x.member_id === id);
  document.getElementById("cardPreview").innerHTML = `
    <div class="card-preview">
      <h3>${m.full_name}</h3>
      <p>${m.position}</p>
      <p>ID: ${m.member_id}</p>
      <p>${m.department}</p>
    </div>`;
}

loadMembers();
</script>

</body>
</html>
