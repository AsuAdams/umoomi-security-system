<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Register Member â€“ Umoomi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FONT AWESOME -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

<style>
* { box-sizing:border-box; margin:0; padding:0; }
body {
  font-family:"Segoe UI", sans-serif;
  background:#f2f2f2;
  padding:30px;
}

.container {
  max-width:600px;
  margin:auto;
  background:white;
  padding:25px;
  border-radius:10px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
}

h2 { margin-bottom:20px; color:#2c3e50; }

label { display:block; margin-top:12px; font-weight:600; }

input, select {
  width:100%;
  padding:12px;
  margin-top:5px;
  border-radius:6px;
  border:2px solid #ddd;
}

button {
  margin-top:20px;
  padding:12px;
  width:100%;
  border:none;
  border-radius:6px;
  font-size:1rem;
  cursor:pointer;
}

.primary { background:#3498db; color:white; }

.photo-box {
  margin-top:15px;
  text-align:center;
}

.photo-box img {
  width:140px;
  height:140px;
  border-radius:10px;
  object-fit:cover;
  border:2px solid #ddd;
  margin-top:10px;
}

small { color:#666; }
</style>
</head>

<body>

<div class="container">
<h2><i class="fas fa-user-plus"></i> Register Member</h2>

<label>Full Name</label>
<input id="full_name" placeholder="Full name">

<label>Position</label>
<input id="position" placeholder="Position">

<label>Department</label>
<input id="department" placeholder="Department">

<label>Region</label>
<input id="region" placeholder="Region">

<label>Status</label>
<select id="status">
  <option>Active</option>
  <option>Inactive</option>
  <option>Suspended</option>
</select>

<label>Photo</label>
<input type="file" id="photoInput" accept="image/*">

<div class="photo-box">
  <small>Preview</small>
  <img id="preview" src="https://via.placeholder.com/140">
</div>

<button class="primary" onclick="registerMember()">
  <i class="fas fa-save"></i> Save Member
</button>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const client = window.supabase.createClient(
  "https://pqrsljahrnjgkadflbmr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo"
);

let photoFile = null;

photoInput.onchange = e => {
  photoFile = e.target.files[0];
  preview.src = URL.createObjectURL(photoFile);
};

function generateMemberID(){
  return "UMO-" + Date.now();
}

async function registerMember(){
  if(!full_name.value){
    alert("Name required");
    return;
  }

  let photo_url = null;

  if(photoFile){
    const fileName = generateMemberID() + ".jpg";
    const { error:uploadError } = await client.storage
      .from("photos")
      .upload(fileName, photoFile, { upsert:true });

    if(uploadError){
      alert(uploadError.message);
      return;
    }

    const { data } = client.storage.from("photos").getPublicUrl(fileName);
    photo_url = data.publicUrl;
  }

  const member = {
    member_id: generateMemberID(),
    full_name: full_name.value,
    position: position.value,
    department: department.value,
    region: region.value,
    status: status.value,
    photo_url
  };

  const { error } = await client.from("umoomi_members").insert(member);
  if(error){
    alert(error.message);
  } else {
    alert("Member registered successfully");
    location.reload();
  }
}
</script>
</body>
</html>
