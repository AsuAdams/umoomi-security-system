<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard â€“ Umoomi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:"Segoe UI",sans-serif;background:#f2f2f2;padding:20px}
.container{max-width:1500px;margin:auto}

/* HEADER */
header{
  background:#fff;padding:20px;border-radius:10px;
  display:flex;align-items:center;gap:15px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  margin-bottom:20px
}

/* LAYOUT */
.layout{display:grid;grid-template-columns:240px 1fr;gap:20px}

/* SIDEBAR */
aside{
  background:#fff;border-radius:10px;padding:15px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
}
aside button{
  width:100%;border:none;background:none;
  padding:12px 15px;border-radius:6px;
  text-align:left;cursor:pointer;
  margin-bottom:6px;font-size:1rem;color:#2c3e50
}
aside button i{width:22px;margin-right:10px}
aside button.active,aside button:hover{
  background:#3498db;color:#fff
}

/* MAIN */
main{
  background:#fff;border-radius:10px;padding:20px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  min-height:75vh
}

/* DASH GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:20px
}

/* CARD */
.card{
  background:#fafafa;border-radius:10px;
  padding:18px;border:1px solid #eee
}
.card h3{margin-bottom:12px;font-size:1.1rem}
.card i{color:#3498db;margin-right:6px}

/* FORM */
input,select{
  width:100%;padding:10px;
  border-radius:6px;border:1px solid #ccc;
  margin-bottom:10px
}
button.action{
  padding:10px 14px;border:none;
  border-radius:6px;background:#3498db;
  color:#fff;cursor:pointer
}
button.danger{background:#c0392b}
button.success{background:#2ecc71}

/* TABLE */
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:.95rem}

/* LOGIN MODAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:flex;align-items:center;
  justify-content:center;z-index:999
}
.modal-box{
  background:#fff;border-radius:10px;
  padding:25px;width:360px;text-align:center
}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<header>
  <i class="fas fa-user-shield fa-2x"></i>
  <div>
    <h2>Admin Dashboard</h2>
    <small>System Management Panel</small>
  </div>
</header>

<div class="layout">

<!-- SIDEBAR -->
<aside>
  <button onclick="location.href='index.html'"><i class="fas fa-chart-line"></i> Dashboard</button>
  <button onclick="location.href='members.html'"><i class="fas fa-users"></i> Members</button>
  <button onclick="location.href='scanner.html'"><i class="fas fa-qrcode"></i> Scanner</button>
  <button onclick="location.href='regions.html'"><i class="fas fa-map-marker-alt"></i> Regions</button>
  <button onclick="location.href='scan-logs.html'"><i class="fas fa-history"></i> Logs</button>
  <button class="active"><i class="fas fa-user-shield"></i> Admin</button>
  <button onclick="location.href='settings.html'"><i class="fas fa-cog"></i> Settings</button>
</aside>

<!-- MAIN -->
<main id="adminContent" class="hidden">

<div class="grid">

<!-- ADD MEMBER -->
<div class="card">
<h3><i class="fas fa-user-plus"></i>Add Member</h3>
<input id="m_id" placeholder="Member ID">
<input id="m_name" placeholder="Full Name">
<select id="m_region"></select>
<button class="action" onclick="addMember()">Add Member</button>
</div>

<!-- ID SETTINGS -->
<div class="card">
<h3><i class="fas fa-id-card"></i>ID Expiry</h3>
<input id="expiry" type="number" placeholder="Expiry (years)">
<button class="action" onclick="updateExpiry()">Update Expiry</button>
</div>

<!-- REGIONS -->
<div class="card">
<h3><i class="fas fa-map-marker-alt"></i>Regions</h3>
<input id="newRegion" placeholder="Add Region">
<button class="success" onclick="addRegion()">Add</button>
<ul id="regionsList"></ul>
</div>

<!-- MEMBERS TABLE -->
<div class="card" style="grid-column:1/-1">
<h3><i class="fas fa-users-cog"></i>Manage Members</h3>
<table>
<thead>
<tr><th>ID</th><th>Name</th><th>Status</th><th>Actions</th></tr>
</thead>
<tbody id="membersTable"></tbody>
</table>
</div>

</div>
</main>
</div>
</div>

<!-- LOGIN -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <h3>Admin Login</h3>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button class="action" onclick="login()">Login</button>
    <p id="err" style="color:#c0392b;margin-top:10px"></p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* ===== CONFIG ===== */
const ADMIN_USER="admin";
const ADMIN_PASS="umoomi123";
const SUPABASE_URL="https://pqrsljahrnjgkadflbmr.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo";
/* ================== */

const db=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);
const modal=document.getElementById("loginModal");
const admin=document.getElementById("adminContent");

/* LOGIN */
function login(){
  if(user.value===ADMIN_USER && pass.value===ADMIN_PASS){
    modal.style.display="none";
    admin.classList.remove("hidden");
    sessionStorage.setItem("admin","yes");
    loadAll();
  }else err.textContent="Invalid credentials";
}
if(sessionStorage.getItem("admin")==="yes"){
  modal.style.display="none";
  admin.classList.remove("hidden");
  loadAll();
}

/* LOAD */
async function loadAll(){
  loadMembers();
  loadRegions();
}

/* MEMBERS */
async function loadMembers(){
  const {data}=await db.from("umoomi_members").select("*");
  membersTable.innerHTML=data.map(m=>`
  <tr>
    <td>${m.member_id}</td>
    <td>${m.full_name}</td>
    <td>${m.status}</td>
    <td>
      <button class="action" onclick="toggle('${m.member_id}','${m.status}')">
        ${m.status==="Active"?"Deactivate":"Activate"}
      </button>
      <button class="danger" onclick="printID('${m.member_id}')">Print</button>
    </td>
  </tr>`).join("");
}

/* ACTIONS */
async function addMember(){
  await db.from("umoomi_members").insert({
    member_id:m_id.value,
    full_name:m_name.value,
    region:m_region.value,
    status:"Active"
  });
  loadMembers();
}

async function toggle(id,status){
  await db.from("umoomi_members")
    .update({status:status==="Active"?"Inactive":"Active"})
    .eq("member_id",id);
  loadMembers();
}

function printID(id){
  window.open("members.html?print="+id,"_blank");
}

/* REGIONS */
async function loadRegions(){
  const {data}=await db.from("regions").select("*");
  m_region.innerHTML=data.map(r=>`<option>${r.name}</option>`).join("");
  regionsList.innerHTML=data.map(r=>`
    <li>${r.name}
    <button class="danger" onclick="removeRegion('${r.id}')">x</button>
    </li>`).join("");
}
async function addRegion(){
  await db.from("regions").insert({name:newRegion.value});
  loadRegions();
}
async function removeRegion(id){
  await db.from("regions").delete().eq("id",id);
  loadRegions();
}

/* EXPIRY */
async function updateExpiry(){
  await db.from("settings")
    .update({id_expiry_years:expiry.value})
    .eq("key","global");
  alert("Expiry updated");
}
</script>
</body>
</html>
