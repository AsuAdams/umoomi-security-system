<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel â€“ Umoomi Security System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ICONS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:"Segoe UI",sans-serif;background:#f2f2f2;padding:20px}
.container{max-width:1400px;margin:auto}

/* HEADER */
header{
  background:#fff;padding:20px;border-radius:10px;
  display:flex;align-items:center;gap:15px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  margin-bottom:20px
}
header i{font-size:2.5rem;color:#2c3e50}

/* LAYOUT */
.layout{display:grid;grid-template-columns:240px 1fr;gap:20px}

/* SIDEBAR */
aside{
  background:#fff;border-radius:10px;padding:15px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  height:calc(100vh - 160px)
}
aside a{
  display:block;text-decoration:none;
  padding:12px 15px;border-radius:6px;
  color:#2c3e50;margin-bottom:6px;font-size:1rem
}
aside a i{width:22px;margin-right:10px}
aside a.active,aside a:hover{
  background:#3498db;color:#fff
}

/* MAIN */
main{
  background:#fff;border-radius:10px;padding:20px;
  box-shadow:0 4px 6px rgba(0,0,0,.1);
  height:calc(100vh - 160px);
  overflow:auto
}

/* FORM */
form{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-bottom:20px
}
form input,form select{
  padding:10px;border-radius:6px;
  border:2px solid #ddd;font-size:.95rem
}
form button{
  border:none;
  background:#2ecc71;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
  font-size:.95rem
}

/* TABLE */
table{width:100%;border-collapse:collapse}
th{
  background:#2c3e50;color:#fff;
  padding:12px;position:sticky;top:0
}
td{padding:10px;border-bottom:1px solid #eee}
tr:hover{background:#f8f9fa}

.badge.active{
  background:#d4edda;color:#155724;
  padding:4px 10px;border-radius:20px;font-size:.85rem
}
.badge.inactive{
  background:#f8d7da;color:#721c24;
  padding:4px 10px;border-radius:20px;font-size:.85rem
}

.actions button{
  border:none;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
  margin-right:4px
}
.edit{background:#3498db;color:#fff}
.delete{background:#e74c3c;color:#fff}
.logout{
  margin-left:auto;
  background:#e74c3c;
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer
}
</style>
</head>

<body>
<div class="container">

<header>
  <i class="fas fa-user-shield"></i>
  <div>
    <h2>Admin Panel</h2>
    <small>Manage Members</small>
  </div>
  <button class="logout" onclick="logout()">
    <i class="fas fa-sign-out-alt"></i> Logout
  </button>
</header>

<div class="layout">

<!-- SIDEBAR -->
<aside>
  <a href="index.html"><i class="fas fa-users"></i> View Members</a>
  <a href="scanner.html"><i class="fas fa-qrcode"></i> Scan ID</a>
  <a href="scan-logs.html"><i class="fas fa-history"></i> Activity Logs</a>
  <a href="admin.html" class="active"><i class="fas fa-user-shield"></i> Admin Panel</a>
  <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
</aside>

<!-- MAIN -->
<main>

<h3 style="margin-bottom:10px">Add / Update Member</h3>

<form id="memberForm">
  <input id="member_id" placeholder="Member ID (QR value)" required>
  <input id="full_name" placeholder="Full Name" required>
  <input id="region" placeholder="Region">
  <select id="status">
    <option value="Active">Active</option>
    <option value="Inactive">Inactive</option>
  </select>
  <button type="submit">
    <i class="fas fa-save"></i> Save
  </button>
</form>

<table>
  <thead>
    <tr>
      <th>Member ID</th>
      <th>Name</th>
      <th>Region</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="membersBody"></tbody>
</table>

</main>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* SUPABASE */
const client = window.supabase.createClient(
  "https://pqrsljahrnjgkadflbmr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo"
);

let editingId=null;

/* ðŸ” AUTH GUARD */
(async()=>{
  const { data:{ user } } = await client.auth.getUser();
  if(!user){
    window.location.href="login.html";
  }
})();

/* LOGOUT */
async function logout(){
  await client.auth.signOut();
  window.location.href="login.html";
}

/* LOAD MEMBERS */
async function loadMembers(){
  const { data } = await client
    .from("umoomi_members")
    .select("*")
    .order("created_at",{ascending:false});

  membersBody.innerHTML=(data||[]).map(m=>`
    <tr>
      <td>${m.member_id}</td>
      <td>${m.full_name}</td>
      <td>${m.region||"-"}</td>
      <td>
        <span class="badge ${m.status==="Active"?"active":"inactive"}">
          ${m.status}
        </span>
      </td>
      <td class="actions">
        <button class="edit" onclick="editMember('${m.id}')">
          <i class="fas fa-edit"></i>
        </button>
        <button class="delete" onclick="deleteMember('${m.id}')">
          <i class="fas fa-trash"></i>
        </button>
      </td>
    </tr>
  `).join("");
}

/* SAVE MEMBER */
memberForm.onsubmit=async e=>{
  e.preventDefault();

  const payload={
    member_id: member_id.value.trim(),
    full_name: full_name.value.trim(),
    region: region.value.trim(),
    status: status.value
  };

  if(editingId){
    await client.from("umoomi_members")
      .update(payload).eq("id",editingId);
  }else{
    await client.from("umoomi_members").insert(payload);
  }

  memberForm.reset();
  editingId=null;
  loadMembers();
};

/* EDIT */
async function editMember(id){
  const { data } = await client
    .from("umoomi_members")
    .select("*").eq("id",id).single();

  editingId=id;
  member_id.value=data.member_id;
  full_name.value=data.full_name;
  region.value=data.region||"";
  status.value=data.status;
}

/* DELETE */
async function deleteMember(id){
  if(!confirm("Delete this member?")) return;
  await client.from("umoomi_members").delete().eq("id",id);
  loadMembers();
}

/* INIT */
loadMembers();
</script>

</body>
</html>
