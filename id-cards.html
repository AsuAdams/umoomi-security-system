<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ID Card | Umoomi Security</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FONT AWESOME -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

<!-- QR CODE -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body {
  background:#e0e0e0;
  font-family:"Segoe UI",sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

/* CARD CONTAINER */
.card {
  width:340px;
  height:215px;
  perspective:1000px;
}

/* FLIP */
.inner {
  width:100%;
  height:100%;
  position:relative;
  transform-style:preserve-3d;
  transition:.8s;
}
.card:hover .inner { transform:rotateY(180deg); }

/* SIDES */
.side {
  position:absolute;
  width:100%;
  height:100%;
  backface-visibility:hidden;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}

/* FRONT */
.front {
  background:white;
  padding:15px;
}

.header {
  display:flex;
  align-items:center;
  gap:10px;
  border-bottom:2px solid #3498db;
  padding-bottom:5px;
}

.header i { font-size:1.8rem; color:#3498db; }

.photo {
  width:90px;
  height:110px;
  border-radius:6px;
  object-fit:cover;
  border:2px solid #2c3e50;
}

.info {
  font-size:.75rem;
  margin-top:6px;
}

.label { font-weight:600; color:#2c3e50; }

/* BACK */
.back {
  background:#2c3e50;
  color:white;
  transform:rotateY(180deg);
  padding:15px;
  text-align:center;
}

.qr { margin:10px auto; }

.expiry {
  font-size:.8rem;
  margin-top:8px;
}

.footer {
  font-size:.6rem;
  margin-top:8px;
  opacity:.8;
}
</style>
</head>

<body>

<div class="card">
  <div class="inner">

    <!-- FRONT -->
    <div class="side front">
      <div class="header">
        <i class="fas fa-shield-alt"></i>
        <div>
          <strong>Umoomi Security</strong><br>
          <small>Ahmadiyya Muslim Community</small>
        </div>
      </div>

      <div style="display:flex;gap:10px;margin-top:10px;">
        <img id="photo" class="photo" src="https://via.placeholder.com/90x110">

        <div class="info">
          <div><span class="label">Name:</span> <span id="name"></span></div>
          <div><span class="label">ID:</span> <span id="mid"></span></div>
          <div><span class="label">Position:</span> <span id="position"></span></div>
          <div><span class="label">Dept:</span> <span id="department"></span></div>
          <div><span class="label">Region:</span> <span id="region"></span></div>
        </div>
      </div>
    </div>

    <!-- BACK -->
    <div class="side back">
      <h4>Official ID Card</h4>
      <div id="qr" class="qr"></div>
      <div class="expiry">
        Expiry: <strong id="expiry"></strong>
      </div>
      <div class="footer">
        Property of Ahmadiyya Muslim Community Uganda<br>
        Unauthorized use is prohibited
      </div>
    </div>

  </div>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const client = window.supabase.createClient(
  "https://pqrsljahrnjgkadflbmr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo"
);

/* GET MEMBER ID */
const id = new URLSearchParams(location.search).get("id");

async function loadCard() {
  const { data, error } = await client
    .from("umoomi_members")
    .select("*")
    .eq("member_id", id)
    .single();

  if (error || !data) {
    alert("Invalid ID");
    return;
  }

  name.textContent = data.full_name;
  mid.textContent = data.member_id;
  position.textContent = data.position;
  department.textContent = data.department;
  region.textContent = data.region || "-";
  expiry.textContent = data.expiry_date || "N/A";
  photo.src = data.photo_url || "https://via.placeholder.com/90x110";

  new QRCode(document.getElementById("qr"), {
    text: data.member_id,
    width:100,
    height:100
  });
}

loadCard();
</script>
</body>
</html>
